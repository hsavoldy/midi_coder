(()=>{"use strict";var __webpack_modules__={742:(e,t,_)=>{_.d(t,{D4:()=>m,l2:()=>n});var i=_(138),n=!1,s="",a=0,r=0,o=["?",":"],l=[">=","<=","==","*","/","+","-"," "],u=[15,31,46,72,87,103,118,127],c=["CC1","CC2","CC3","CC4","CC5","CC6","CC7","CC8","(",")","x"],d=[11,23,34,46,57,69,80,92,103,115,127],p=[...Array(25).keys()].map((e=>(e-12).toString()));function m(e){var t=s;if(function(e){return e[0]>=176&&e[0]<=191}(e))if(a%2==0){var _=null;for(let t=0;t<d.length;t++)if(e[2]<=d[t]){_=t;break}s=s.slice(0,s.lastIndexOf(c[m]))+c[_],m=_}else{var n=null;for(let t=0;t<u.length;t++)if(e[2]<=u[t]){n=t;break}s=s.slice(0,s.lastIndexOf(l[p]))+l[n],p=n}else(function(e){return e[0]>=144&&e[0]<=159})(e)&&(" "==l[p]&&r<3&&(s=s.slice(0,s.length-1),2==r?h=!0:(s+=o[r],r+=1)),s+=h?")":a%2==0?" "+l[0]:" "+c[0],a+=1,p=0,m=0);if((0,i.Gx)(t,s),h)var p=0,m=0,h=!1}c=c.concat(p)},138:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{AB:()=>globalClock,Gq:()=>onClock,Gx:()=>replaceString,Wp:()=>mapping,hu:()=>seqsToStart,l3:()=>midiClock});var _midi_control_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(711),_seq_control_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(229),_algorithm_control_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(742),_midi_math_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(874),globalClock=0,beatsPerMeasure=4,noteOns=null,midiClock=!1,clockWorker=null,tempo=110,mapping=!1,major=null,minor=null,scale=null,seqArrays={};function enableLiveCoding(code){code=code.replace("globalThis.",""),code=code.replaceAll("midiMain.","");var lines=code.split("\n");for(var line of lines)if(!line.includes("//")){var inputs=removeArray(line).replace("/","").match(/(\w+)\s*=\s*new\s+Seq\((\w+),?\s*(\w+)?,?\s*\d*\)/);if(inputs){var seqName=inputs[1],notes=isNumber(inputs[2])?null:inputs[2],durs=isNumber(inputs[3])?null:inputs[3];seqArrays[seqName]=[notes,durs]}}code=code.replace("var",""),code=code.replace("let",""),code=code.replace("const","");var assignments=code.match(/(\s+(\w+)\s*=\s*([^;]+))|((\w+)\s*=\s*([^;]+))/g);if(assignments)for(var i=0;i<assignments.length;i++){var assignment=assignments[i].match(/\s*(\w+)\s*=\s*([^;]+)/);if(assignment){var variableName=assignment[1];window[variableName]=eval(assignment[1]),eval(variableName)instanceof Seq&&(seqsToStart[variableName]=eval(variableName),eval(variableName).valsName=seqArrays[variableName][0],eval(variableName).dursName=seqArrays[variableName][1])}}}function initializeMidiCoder(){navigator.requestMIDIAccess().then(onMIDISuccess,onMIDIFailure),setupClock()}function initialCode(e){return e=(e=e.replaceAll(/\/\*\nMIDI Inputs:\n(\d+.*\n)*MIDI Outputs:\n(\d+.*\n?)*\n\*\/\n*/gi,"")).replaceAll(/midiMain.setMidiInput\(\d+\);\nmidiMain.setMidiOutput\(\d+\);\n*/gi,""),null===midi?e:"/*\n"+getMidiIO()+"*/\nmidiMain.setMidiInput(1);\nmidiMain.setMidiOutput(1);\n"+e}function setMidiClock(e){midiClock=e,setupClock()}function setupClock(){if(window.Worker){var e=new Worker(new URL(__webpack_require__.p+__webpack_require__.u(542),__webpack_require__.b));e.postMessage({type:"start",interval:1/(tempo/60)*1e3/24}),e.onmessage=e=>{midiClock||onClock(),e.data}}else console.warn("browser doesn't support internal clock")}function changeTempo(e){setupClock()}function changeRow(e){beatsPerMeasure=e,console.log("beats per measure: "+beatsPerMeasure)}function onClock(){if(globalClock%(24*beatsPerMeasure)==0){for(var e in seqsToStart)e in _seq_control_js__WEBPACK_IMPORTED_MODULE_1__.ot&&_seq_control_js__WEBPACK_IMPORTED_MODULE_1__.ot[e].stop(),_seq_control_js__WEBPACK_IMPORTED_MODULE_1__.ot[e]=seqsToStart[e],_seq_control_js__WEBPACK_IMPORTED_MODULE_1__.ot[e].name=e,_seq_control_js__WEBPACK_IMPORTED_MODULE_1__.ot[e].start();seqsToStart={}}if(globalClock+=1,(0,_seq_control_js__WEBPACK_IMPORTED_MODULE_1__.kY)(),0!=mapping&globalClock%10==0){console.log("sending");const e=[mapping[0],mapping[1],1];_midi_control_js__WEBPACK_IMPORTED_MODULE_0__.np.outputs.get(_midi_control_js__WEBPACK_IMPORTED_MODULE_0__.oI).send(e)}}var seqs=null;function changeTimeSig(e){reset()}var seqsToStart={};function checkStringForNonVariable(e){for(var t=0;t<e.length;t++){if("("==e[t])return!0;if("{"==e[t])return!0;if("\t"==e[t])return!0;if("="==e[t])return!1}return!1}function isNumber(e){return!isNaN(parseInt(e))}function removeArray(e){for(;e.includes("[");)e=e.slice(0,e.indexOf("["))+"0"+e.slice(e.indexOf("]")+1);return e}function addToEditor(e){}function replaceLastLine(e){}function replaceString(e,t){}function freezeEditor(){}function unfreezeEditor(){}},711:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{np:()=>midi,oI:()=>outputMidiID});var _index_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(138),_seq_control_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(229),_algorithm_control_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(742),midi=null,muted=!1,outputMidiID=null,midiMsgs={},ccCallbacks={},beat=0;function onMIDISuccess(e){console.log("MIDI ready!"),midi=e}function onMIDIFailure(e){console.error(`Failed to get MIDI access - ${e}`)}eval("globalThis.setMidiInput1 = setMidiInput;");var midi_input_ids={},midi_output_ids={},midi_input_names={},midi_output_names={};function getMidiIO(){var e="MIDI Inputs:\n",t="MIDI Outputs:\n",_=null,i=null,n=1;for(var s of midi.outputs)t+=n+": "+s[1].name+"\n",i=s[1].id,midi_output_ids[n]=i,midi_output_names[n]=s[1].name,n+=1;for(var a of(n=1,midi.inputs))e+=n+": "+a[1].name+"\n",_=a[1].id,midi_input_ids[n]=_,midi_input_names[n]=a[1].name,n+=1;return e+t}function setMidiInput(e){for(var t of(Array.isArray(e)||(e=[e]),midi.inputs.forEach((function(e,t){e.onmidimessage=null})),e))t in midi_input_ids&null!=midi.inputs.get(midi_input_ids[t])?(midi.inputs.get(midi_input_ids[t]).onmidimessage=handleMidiInput,console.log("MIDI input set to: "+midi_input_names[t])):console.warn("Invalid input ID")}function setMidiOutput(e){Array.isArray(e)&&console.warn("Can only handle one MIDI output. Please enter one ID."),e in midi_output_ids&null!=midi.outputs.get(midi_output_ids[e])?(outputMidiID=midi_output_ids[e],console.log("MIDI output set to: "+midi_output_names[e])):console.warn("Invalid output ID")}function handleMidiInput(e){if(null!=e.data[1]){let t="note";e.data[0]>>4==11&&(t="cc")}_index_js__WEBPACK_IMPORTED_MODULE_0__.l3&&getMIDIClock(e),_algorithm_control_js__WEBPACK_IMPORTED_MODULE_2__.l2?e.data[2]>0&&(0,_algorithm_control_js__WEBPACK_IMPORTED_MODULE_2__.D4)(e.data):(midiReset(e),handleNote(e),handleCC(e))}function midiReset(e){var t=e.data[0];250==t?(console.log("midi start"),(0,_seq_control_js__WEBPACK_IMPORTED_MODULE_1__.mc)()):255==t&&(console.log("midi reset"),(0,_seq_control_js__WEBPACK_IMPORTED_MODULE_1__.mc)())}function getMIDIClock(e){248==e.data[0]&&(0,_index_js__WEBPACK_IMPORTED_MODULE_0__.Gq)(),_index_js__WEBPACK_IMPORTED_MODULE_0__.AB%24==0&&(beat+=1)}function handleCC(message){var command=message.data[0],note=message.data[1],value=message.data.length>2?message.data[2]:0;if(command>=176&command<=191){midiMsgs[note]=value,eval("globalThis.CC"+note+"="+value+";");try{eval("CC"+note+"_func")()}catch{}}}function handleNote(message){var command=message.data[0],note=message.data[1],velocity=message.data.length>2?message.data[2]:0;if(command>=144&command<=159){midiMsgs[note]=velocity;try{eval("midi"+note%12+"_func")()}catch{}for(var key in _seq_control_js__WEBPACK_IMPORTED_MODULE_1__.ot){var seq=_seq_control_js__WEBPACK_IMPORTED_MODULE_1__.ot[key];seq.repopulating&&seq.newVals.push(note),seq.inserting&&seq.vals.push(note)}}else command>=128&command<=143&&(midiMsgs[note]=null)}function midiMap(e){_index_js__WEBPACK_IMPORTED_MODULE_0__.Wp=[144,e],muted=!0}function ccMap(e){_index_js__WEBPACK_IMPORTED_MODULE_0__.Wp=[176,e],muted=!0}function stopMap(){const e=[128,_index_js__WEBPACK_IMPORTED_MODULE_0__.Wp[1],0];midi.outputs.get(outputMidiID).send(e),_index_js__WEBPACK_IMPORTED_MODULE_0__.Wp=!1,muted=!1}function mute(){muted=!0}function unmute(){muted=!1}function toggleMute(){muted=!muted}},874:(e,t,_)=>{_(229)},229:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{kY:()=>checkSeqs,mc:()=>reset,ot:()=>seqs_dict});var _index_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(138),_midi_control_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(711),_midi_math_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(874),bar=0,column=null,divID="display-box",seqs_dict={},_=null;function checkSeqs(){for(var e in seqs_dict){var t=seqs_dict[e];t.timeForNext()&&(t.callback(),t.executeStep()),t.restarted&&(_index_js__WEBPACK_IMPORTED_MODULE_0__.hu[e]=t,t.restarted=!1)}}function reset(){for(var e in seqs_dict)seqs_dict[e].reset();_index_js__WEBPACK_IMPORTED_MODULE_0__.AB=0}function checkChannel(e){return e>16?(console.warn("Cannot have a channel larger than 16. Using channel 1."),e=1):e<=0&&(e=1),e}function stopEverything(){for(let e in seqs_dict)seqs_dict[e].stop();seqs_dict={}}var seqs_dict={};class Seq{constructor(e,t=1/4,_=0){this.vals=e,this.durs=t,this.noteInd=0,this.dursInd=0,this.noteInc=1,this.dursInc=1,this.repopulating=!1,this.inserting=!1,this.stopped=!1,this.nextValTime=globalClock,this.channel=_,this.velocity=127,this.controllerNum=7,this.restarted=!1,this.monitor=!1,this.newVals=[],this.lastNoteSent=null,_>16&&(console.warn("Cannot have a channel larger than 16. Setting channel to 1."),this.channel=1),this.stepFunc=this.sendNote,this.name="",this.octave=0,this.valsName=null,this.dursName=null}executeStep(){this.updateArrays(),this.stepFunc()}sendNoteOff(e){if(null==e|e<0)return;const t=[128+checkChannel(this.channel)-1,e,0];midi.outputs.get(outputMidiID).send(t)}transform(e){return e}sendNote(){var e=this.nextVal(),t=this.velocity;if(null==(e=this.transform(e)))return;if(muted)return;var _,i=checkChannel(this.channel);if(e>-9e8&&e<-7e6)return;if(this.sendNoteOff(this.lastNoteSent,this.channel),null!=scale){var n=!1,s=e;10*e%10!=0&&(s=Math.floor(Math.abs(e))*e/Math.abs(e),n=!0),_=scale.slice(s%scale.length)[0]+12*Math.floor(s/scale.length)+12*this.octave,n&&(e>0?_+=1:_-=1)}else _=e;if(_<0||null==_||_>127)return;const a=[144+i-1,_,t];midi.outputs.get(outputMidiID).send(a),this.lastNoteSent=_;Math.floor(globalClock/(24*beatsPerMeasure));Math.floor(globalClock/24),beatsPerMeasure,this.monitor&&console.log(this.name+" midi: "+_," vel: "+t)}sendCC(){var e=this.transform(this.nextVal()),t=this.controllerNum;const _=[176+Window.checkChannel(this.channel)-1,t,e];muted||(midi.outputs.get(outputMidiID).send(_),console.log(_))}timeForNext(){return!this.stopped&&this.nextValTime<=globalClock}nextVal(){if(0===this.vals.length)return this.noteInd=0,null;var e=this.vals[floor(this.noteInd)];this.updateNoteIndex(),this.noteInd=this.noteInd%this.vals.length;var t;return t="number"!=typeof this.durs?this.durs[floor(this.dursInd)]:this.durs,this.nextValTime=globalClock+24*t*4,this.updateDurIndex(),"number"!=typeof this.durs&&(this.dursInd=this.dursInd%this.durs.length),e}updateNoteIndex(){this.noteInd=this.noteInd+this.noteInc}updateDurIndex(){this.dursInd=this.dursInd+this.dursInc}repopulate(){this.newVals=[],this.repopulating=!0}stopPop(){this.noteInd>=this.newVals.length&&(this.noteInd=this.newVals.length-1),this.vals=this.newVals,this.repopulating=!1}appendNote(e){this.vals.push(e)}stop(){this.stopped=!0,this.sendNoteOff(this.lastNoteSent,this.channel)}start(){this.stopped=!1}reset(){this.noteInd=0,this.dursInd=0,this.nextValTime=0,this.sendNoteOff(this.lastNoteSent,this.channel),this.restarted=!0,this.stop()}addFunction(e){this.callback=e}callback(){}updateArrays(){if(this.valsName){var newVals=eval("globalThis."+this.valsName);this.noteInd=this.noteInd%newVals.length,this.vals=newVals}if(this.dursName){var newDurs=eval("globalThis."+this.dursName);Array.isArray(newDurs)&&(this.dursInd=this.dursInd%newDurs.length),this.durs=newDurs}}}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var _=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](_,_.exports,__webpack_require__),_.exports}__webpack_require__.m=__webpack_modules__,__webpack_require__.d=(e,t)=>{for(var _ in t)__webpack_require__.o(t,_)&&!__webpack_require__.o(e,_)&&Object.defineProperty(e,_,{enumerable:!0,get:t[_]})},__webpack_require__.u=e=>e+".js",__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;__webpack_require__.g.importScripts&&(e=__webpack_require__.g.location+"");var t=__webpack_require__.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var _=t.getElementsByTagName("script");if(_.length)for(var i=_.length-1;i>-1&&!e;)e=_[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpack_require__.p=e})(),__webpack_require__.b=document.baseURI||self.location.href;var __webpack_exports__=__webpack_require__(138)})();